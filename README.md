

# Synthetic & Simulated Population (SysPop)

<p align="center" style="margin-bottom:0">
    <img src="etc/wiki_img/silverstream_travel.gif?raw=true" alt="Sample Image" width="50%">
</p>
<p align="center" style="margin-top:0">
    <img src="etc/wiki_img/241800.png?raw=true" alt="Sample Image" width="37.5%">
    <img src="etc/wiki_img/work_place.gif?raw=true" alt="Sample Image" width="40%">
</p>


_The above animations show: Top: where people travel to from 241800 (Silverstream, Upper Hutt) between 7am and 9am_. Bottom-left: _The reasons why people visit the SA2 area 241800 (Silverstream, Upper Hutt)._ Bottom-right: _Where people go to work in one day (3000 sampled synthetic citizens across Auckland region)_.


**Syspop** is a package developed to simplify and modularize the synthesis of populations, enhancing efficiency and user-friendliness. The outputs generated by **Syspop** are independent of any downstream applications, such as agent-based models, making them versatile inputs for various modeling needs or standalone products. 

**Syspop** supports both _python_ and _R_.

**The documentation for the package can be found at [SysPop Wiki](https://github.com/jzanetti/Syspop/wiki). Any questions please contact: _Sijin.Zhang@esr.cri.nz_**

### Contents:

* [Installation](https://github.com/jzanetti/Syspop#installation)
* [Usage](https://github.com/jzanetti/Syspop#usage)
* [Output](https://github.com/jzanetti/Syspop#output)

## üåü Installation
It is recommended to install the package via a local conda environment:
```
make env
```
The above will create a working environment (_python_) for **Syspop**. 

Alternatively, if _R_ is is used, the working environment can be created by
```
renv::restore()
```

## üõ†Ô∏è Usage

### Prepare New Zealand input data

The New Zealand input data can be created by running:

```
make create_nz_data
```

Note that the above command would ask for the configuration file for making the New Zealand data, it is recommended to use `etc/scripts_nz/input_v2.0.yml`


### Creating the Synthetic population

A synthetic population can be created using:

```
from syspop.python.input import new_zealand
from syspop.start import create as syspop_create

test_data = new_zealand()
syn_areas = [236800, 237200]

syspop_create(
    syn_areas=syn_areas,
    output_dir=output_dir,
    pop_structure = test_data["pop_data"]["population_structure"],
    geo_hierarchy=test_data["geog_data"]["hierarchy"],
    geo_location=test_data["geog_data"]["location"],
    geo_address=test_data["geog_data"]["address"],
    household=test_data["household_data"]["household"],
    socialeconomic=test_data["pop_data"]["deprivation"],
    work_data=test_data["work_data"],
    home_to_work=test_data["commute_data"]["travel_to_work"],
    school_data=test_data["school_data"]["school"],
    kindergarten_data=test_data["kindergarten_data"]["kindergarten"],
    hospital_data=test_data["hospital_data"]["hospital"],
    supermarket_data=test_data["supermarket_data"]["supermarket"],
    restaurant_data=test_data["restaurant_data"]["restaurant"],
    department_store_data=test_data["department_store_data"]["department_store"],
    wholesale_data=test_data["wholesale_data"]["wholesale"],
    fast_food_data=test_data["fast_food_data"]["fast_food"],
    pub_data=test_data["pub_data"]["pub"],
    park_data=test_data["park_data"]["park"],
    cafe_data=test_data["cafe_data"]["cafe"],
    birthplace_data=test_data["others"]["birthplace"],
    assign_address_flag=True,
    rewrite_base_pop=True
)
```

Detailed descriptions of the input data for each argument can be found in [Input data](https://github.com/jzanetti/Syspop/wiki/Input-data).

It's important to note that all arguments in the ``syspop.create`` function are optional, and their requirement depends on the specific synthetic information that needs to be generated. To understand the interdependencies between different synthetic information, refer to the documentation available [here](https://github.com/jzanetti/Syspop/wiki/Synthetic-population)

There are many example scripts located in `etc/examples`:

- `run_nz.py`/`run_nz.R`: Creating New Zealand synthetic population
- `run_diary.py`: Creating agents' diary
- `run_validation.py`: Creating validation report for the synthetic population
- `run_vis.py`: Creating visualisation for the synthetic population
  

## üìä Output
The output from **Syspop** is a comprehensive table that contains the information for each synthetic individual, which can be used for any downstream analytic and modeling works. The list of attributes for each synthetic individual can be found [here](https://github.com/jzanetti/Syspop/wiki/Some-basic-attributes-for-Syspop)

| area   | age | gender | ethnicity | household    | ... | school               | primary_hospital    | secondary_hospital   | supermarket                     | restaurant                                        |
| ------ | --- | ------ | --------- | ------------ | --- | -------------------- | ------------------- | -------------------- | ------------------------------- | ------------------------------------------------- |
| 236300 | 0   | female | European  | 236300_4_438 | ... | NaN                  | 237800_hospital_2_0 | 235800_hospital_28_0 | supermarket_284,supermarket_283 | restaurant_1407,restaurant_2551,restaurant_287... |
| 236300 | 13  | male   | Maori     | 236300_8_189 | ... | school_23134_primary | 237800_hospital_2_0 | 235800_hospital_28_0 | supermarket_284,supermarket_283 | restaurant_1407,restaurant_2551,restaurant_287... |
| 236300 | 0   | female | Maori     | 236300_4_638 | ... | NaN                  | 237800_hospital_2_0 | 235800_hospital_28_0 | supermarket_284,supermarket_283 | restaurant_1407,restaurant_2551,restaurant_287... |
| 236300 | 0   | male   | Maori     | 236300_3_220 | ... | NaN                  | 237800_hospital_2_0 | 235800_hospital_28_0 | supermarket_284,supermarket_283 | restaurant_1407,restaurant_2551,restaurant_287... |
| ...    | ... | ...    | ...       | ...          | ... | ...                  | ...                 | ...                  | ...                             | ...                                               |

## üîó R Development
This R version of this package is under development, the following shows the steps for testing the package with R:
- Start a new R env: Run `renv::init()` to initialize renv for your project
- Record R env: `renv::snapshot()`
- Reload R env: Run `renv::restore()` to load the renv environment for your project
- Install R packages: `renv::install(c("x", "y", "z"))`